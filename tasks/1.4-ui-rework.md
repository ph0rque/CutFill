# Plan: UI Rework and Supabase Multiplayer Integration

**Overall Goal:** Refactor the multiplayer system to be fully serverless using Supabase, remove the legacy Node.js server, and begin integrating the Magic UI design system.

### 1. Codebase Cleanup & Architectural Alignment
- **Remove Legacy Server:** The entire `server/` directory, which contains the Node.js/Socket.io implementation, is now considered legacy. It will be removed to prevent architectural conflicts and confusion.
- **Remove Legacy Clients:** The associated client files (`src/src/multiplayer.ts`, `src/src/multiplayer-enhanced.ts`) will also be removed.
- **Consolidate on Supabase:** All multiplayer logic will be centralized in `src/src/supabase-multiplayer.ts`.

### 2. Implement Competitive Lobbies with Supabase
- **Database Schema:** Design and create new Supabase tables to manage lobby state (e.g., `lobbies`, `lobby_players`).
- **Lobby Logic:** Extend `supabase-multiplayer.ts` to handle the full competitive lobby lifecycle:
    - Creating and finding available lobbies.
    - Joining and leaving lobbies.
    - Toggling player "ready" status.
    - Broadcasting lobby state changes to all connected clients using Supabase Realtime.
- **Feature Parity:** Re-implement the features from the legacy `server.js` (like matchmaking, ready-up countdowns, and transitioning to a game) using Supabase functions and database triggers.

### 3. Integrate Frontend with Supabase Multiplayer
- **Connect Guest UI:** Modify `src/src/guest-ui.ts` to call the new lobby functions in `supabase-multiplayer.ts` when a user selects "Competition" mode.
- **Real-time UI Updates:** The `guest-ui.ts` will subscribe to lobby events from `supabase-multiplayer.ts` to display a real-time view of the lobby, including the player list, ready statuses, and match start countdowns.

### 4. Design System Overhaul with Magic UI & Icons
- **Icon Research:** Research and select a suitable open-source icon library (e.g., Lucide, Feather Icons, or a specialized CAD set) that provides clear icons for engineering actions (pan, zoom, cut, fill, etc.).
- **Integrate Magic UI Dock:** Begin replacing the current tool UI by integrating the `Dock` component from Magic UI (`magicui.design`) to house the primary scene manipulation and tool selection controls. This will be the first step in adopting the new design system.

### 5. Update Documentation
- **Update Memory Bank:** Crucially, update the `memory-bank` files (`activeContext.md`, `techContext.md`, etc.) to reflect this major architectural shift from a Node.js server to a serverless Supabase implementation. This will ensure the project's documentation is in sync with the code.
